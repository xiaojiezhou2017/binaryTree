<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    .box {
        height: 30px;
        width: 30px;
        border: 1px solid red;
        position: absolute;
        font-size: 12px;
        border-radius: 50%;
    }
    .line {
        position: absolute;
        border-top: 1px solid red;
        height: 0px;
        width: 150px;
    }
</style>
<body>
</body>
<script>
    const FONT_SIZE = 12;
    const SHAPE = '30';
    const LINE_WIDTH = 300;
    const deep = 0;
    const deepMap = {};
    const RATIO = 3;
    const BASE_DEG = 20;

    function getDeep () {
        let deep = 1;
        const deepMap = new Map();
        
        return function (target, value) {
            if (target === undefined) {
                return 0;
            }
            if (deepMap.has(target)) {
                return deepMap.get(target);
            } else {
                deepMap.set(target, deep++);
                return deepMap.get(target);
            }
        }
    }

    const getDeeper = getDeep();

    function appendNode(parent, value, dir) {
        const moveStance = SHAPE / 2;
        // text
        const textWrap = document.createElement('span');
        const textNode = document.createTextNode(value);
        textWrap.appendChild(textNode);
        textWrap.style.position = "absolute";
        textWrap.style.top = (moveStance - FONT_SIZE / 2) + 'px';
        textWrap.style.left = (moveStance - FONT_SIZE / 2) + 'px';

        if (!parent) {
            const root = document.createElement('div');
            root.setAttribute('class', 'box');
            root.style.left = window.innerWidth / 2 - SHAPE / 2 + 'px';
            document.body.appendChild(root);
            root.appendChild(textWrap);
            return root;
        }
        // 树的深度
        const deep = (parent.deep || 1);
        // 每层边长旋转的角度
        const baseDeg = (parent.deg || BASE_DEG) * 1.5;
        //  const baseDeg = BASE_DEG + deep + RATIO;
        console.log('deg', parent.deg);
        // 边的长度
        const lineWidth = (parent.len || LINE_WIDTH) * 0.7;

        const fragment = document.createDocumentFragment();
        const x = 0;
        const y = 0;
        const line = document.createElement('div');
        line.setAttribute('class', 'line');

        const transformDeg = dir === 'right' ? `${baseDeg}deg` : `${180-baseDeg}deg`;
        line.style.width = lineWidth + 'px';
        line.style.transformOrigin = 'left top'
        // line.style.transform = `rotate(45deg) translateX(${moveStance}px) translateY(${moveStance}px)`;
        line.style.transform = `translateX(${moveStance}px) translateY(${moveStance}px) rotate(${transformDeg})`;

        const child = document.createElement('div');
        child.setAttribute('class', 'box');
        child.appendChild(textWrap);
        child.deep = deep + 1;
        child.len = lineWidth;
        child.deg = baseDeg;
        fragment.appendChild(line);

       
        const deg = Math.PI / 180;
        const letStance = x + lineWidth * Math.cos(deg * baseDeg);
        const topStance = y + lineWidth * Math.sin(deg * baseDeg);
        if (dir === 'right') {
            child.style.left = letStance + 'px';
        } else if (dir === 'left') {
            child.style.left = -letStance + 'px';
        }
        child.style.top = topStance + 'px';
        fragment.appendChild(child);
        parent.appendChild(fragment);
        return child;
    }

    const root = appendNode(undefined, 1);
    const child = appendNode(root, 2, 'right')
    const child2 = appendNode(root, 3, 'left')
    appendNode(child, 4, 'right');
    const child5 = appendNode(child, 5, 'left');
    appendNode(child5, 10, 'right');
    const child11 = appendNode(child5, 11, 'left');
    appendNode(child11, 14, 'left');
    appendNode(child11, 15, 'right');
    const child3 = appendNode(child2, 6, 'right');
    appendNode(child2, 7, 'left');
    appendNode(child3, 8, 'left');
    const child9 = appendNode(child3, 9, 'right');
    appendNode(child9, 12, 'left');
    appendNode(child9, 13, 'right');
</script>
</html>